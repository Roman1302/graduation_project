## 2.3 Практическая реализация Telegram-бота «Расписание Сыктывкара»

Для реализации проекта, автором была осуществлена регистрация Telegram-бота с помощью системного Telegram-бота @BotFather и зафиксированы имя пользователя @RaspSykt_bot и название Telegram-бота «Расписание Сыктывкара». Telegram-боту присвоена ссылка, по которой можно перейти в него из любого браузера https://t.me/RaspSykt_bot.

Создано короткое описание для привлечения подписчиков и с призывом делиться этим Telegram-ботам со своими друзьями и знакомыми через реферальную ссылку, которую они могут создать самостоятельно с помощью команды Telegram-боту «/ref», что позволяет проявить интерес участника к самому Telegram-боту.

Оформление Telegram-бота приведено на рисунке ниже:

![5.png](pictures%2F5.png)

В процессе регистрации был получен и главный секретный токен, который необходим для настройки API.

Далее воспользуемся IDE PyCharm и установим на него дополнительное расширение aiogram с помощью меню IDE или командной строки по команде:

![6.png](pictures%2F6.png)

Для конфиденциальности все секретные данные были вынесены в отдельный системный файл .env

Файл .env - это текстовый файл, который содержит пары ключ-значение всех переменных, требуемых приложением. Этот файл включен в проект локально, не сохраняется в системе управления версиями, чтобы не подвергать риску потенциально конфиденциальную информацию.

В этом файле указаны следующие ключи: 

    • BOT_TOKEN — полученный токен при регистрации

    • ADMIN — ID администратора Telegram-бота

    • PGUZER — имя пользователя базы данных

    • PGPASSWORD — пароль доступа к базе данных

    • DATABASE — название базы данных

![7.png](pictures%2F7.png)

Далее, как уже выше писалось, для начала надо создать файл с базовыми настройками самого Telegram-бота, где прописывается TOKEN, ID администратора, данные для подключения к базе данных.

Следующий файл описывает функцию, запускаемую вместе с запуском Telegram-бота, которая выполняет подключение к базе данных, созданием необходимых таблиц в базе данных (при необходимости можно удалить таблицы) и сообщение админам, что подключение к базе данных произошло успешно, таблицы созданы и Telegram-бот запущен и готов к работе. Это облегчает диагностику начальной работы Telegram-бота.

![8.png](pictures%2F8.png)

Теперь требуется создать меню с командами самого Telegram-бота, для этого делаем асинхронную функцию, где прописываем меню с командами. Эти команды можно вызвать через меню или просто отправить текстом следующего вида, например: «/bus».

![9.png](pictures%2F9.png)

Создадим файл с кодом для главного запуска — команды «/start». В нем пропишем функцию, которая улавливает команду и ID пользователя, а так же ID человека, пригласившего его, если пользователь перешёл по реферальной ссылке. Сделаем проверку, есть этот человек в базе данных или нет, если это новый человек, значит сообщим ему, что он уже зарегистрирован. Если этого пользователя нет в базе данных, то отправим ему приветственное сообщение с именем, если это имя указано у него.

![10.png](pictures%2F10.png)

Так как с Telegram-ботом работает администратор, который может отправлять сообщения конкретному пользователю, требуется установить приватность этих сообщений. Создадим проверку на приватность сообщений отправляемых администратором пользователю и наоборот. 

![11.png](pictures%2F11.png)

В разработанном Telegram-боте предусмотрена возможность отправки рассылки с информированием всех пользователей Telegram-бота об изменениях в расписании. Для этих целей предусмотрена функция создания рассылки с возможностью прикрепления фотографии.

![12.png](pictures%2F12.png)

В самом начале, при создании Telegram-бота была заложена возможность приглашения в Telegram-бот по реферальной ссылки. Для этих целей пропишем код создание реферальной ссылки с помощью команды «/ref». Команда создает реферальную ссылку, отправляет ее пользователю, запросившего её и сообщает о количестве подписавшихся по этой ссылке пользователей. 

![13.png](pictures%2F13.png)

Как и в любой программе нужно предусмотреть действия пользователей, которые пытаются совершить непредсказуемые команды. В этом случае пользователь получит предупреждение, что такой команды нет в Telegram-боте. 

![14.png](pictures%2F14.png)

Если пользователь будет повторять несуществующие команды многократно в течение короткого времени, то будет заблокирован на определенное время, о чем получит сообщение. Это предусмотрено написанным кодом, который устанавливает временное ограничение на неизвестные команды, которые не прописаны в Telegram-боте.

![15.png](pictures%2F15.png)

В Telegram-боте предусмотрено, если требуется помощь или дополнительная информация, а как же он нашёл неточность в расписании, которое размещено в Telegram-боте, то пользователь имеет возможность об этом сообщить администратору Telegram-бота. Для этих целей предусмотрена команда «/help».

![16.png](pictures%2F16.png)

В этой команде есть два варианта общения: просто сообщить о неточности или же вступить в переписку с администратором Telegram-бота. Есть ограничение по времени для вступления в прямую переписку с администратором.

![17.png](pictures%2F17.png)

Основные настройки программирования Telegram-бота описаны выше. Для его круглосуточного функционирования автор проекта разместил Telegram-бот на хостинге https://timeweb.cloud, что позволяет Telegram-боту работать вне зависимом от человека режиме.

Из выше написанного, следует, что разработка Telegram-бота «Расписание Сыктывкара» произведена успешна, Telegram-бот развернут на хостинге и осуществляет свою работу в круглосуточном режиме, помогая пользователям Telegram, осуществляющим передвижение на общественном транспорте узнавать своевременно расписание автобусов. Найти действующий Telegram-бот можно по имени @RaspSykt_bot и названию Telegram-бота «Расписание Сыктывкара». Telegram-боту присвоена ссылка, по которой можно перейти в него из любого браузера https://t.me/RaspSykt_bot.